language: java

jdk:
  - oraclejdk8

env:
  - secure: PbV8H8Uop7tenNqq/FvbDTQqFVHejHmPLJlM56oB0tFjv5xQlw4/nN36j+dezD0GvdQzzWmU7yw/gk3038xuO9sQot6cHKn2Kjm9OAN6qJnP3SRpSqRQGdLp1HFqMycyo71nNS4YsKZgrX6TkbyEFla35RUSqLpweYFGwWXskJnknFHl/bpJ6K77cCl/7DjHyfsFCNXiOtUamN4BtWa2uuUdpQWT3eBWivvYJGWATlyprFFLgkZL9lads+Ek9hf8yywhidXDOAvJrUg72Y+l8mv8tGrG7uqKCaPs1Lb7nNuvN4QxNY9En1LI3/4ITzErH4XqsF3/yAQZmazuLKm2Pg==

services:
 - mysql
 - postgres

build:
  ci:
    - mkdir -p shippable/testresults
    - mkdir -p shippable/codecoverage/target/site/jacoco/html
    - mkdir -p ~/.gradle
    - cp gradle-shippable.properties ~/.gradle/gradle.properties
    - mysql -e "CREATE USER dbuser@localhost IDENTIFIED BY 'dbpass'; GRANT ALL ON *.* TO dbuser@localhost; FLUSH PRIVILEGES;"
    - psql -c "create role dbuser with superuser login password 'dbpass';" -U postgres
    - ./gradlew test -PtestOutputDir=shippable/testresults -PSAUCE_LABS_USERNAME=$SAUCE_LABS_USERNAME -PSAUCE_LABS_KEY=$SAUCE_LABS_KEY --info 
    - cp build/coverage-results/jacoco/ryvr.xml shippable/codecoverage/target/site/jacoco/jacoco.xml
    - cp -r build/coverage-results/jacoco/html/* shippable/codecoverage/target/site/jacoco/.
    - ./gradlew uploadCoverageToCodacy --info 
